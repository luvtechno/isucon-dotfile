# bottleneck

ベンチマークを実行しながら、現在どこにボトルネックがあるのかを調べる。

最適化をすすめていくとボトルネックは違う場所に移るので、適時調べ直す。

### 基本的な流れ

- 前提となるマシンスペックを知る。
- ロードアベレージをみる。まず top を使う。

### より詳しく(?)

- CPUとI/Oどちらがボトルネックか調べる。`sar` や `vmstat` で推移をみる。
- CPUがボトルネックの場合、`top` や `sar` ででユーザプログラムかシステムプログラムか。プロセスの特定に `ps auxw` を使う。
- プロセスの更に詳しく調べる場合は `strace` や `oprofile` を使う。
- 通信内容のキャプチャには `tcpdump` を使う。

### あわせて読みたい

- [単独のサーバーの「負荷」の正体を突き止める](http://tetsuyai.hatenablog.com/entry/20120105/1325750731)

## top

- `Shift + p` CPU使用率
- `Shift + m` メモリ使用率

なお、`uptime` コマンドで得られるのと同様のロードアベレージがヘッダーに表示されている。

```
top - 16:26:52 up 33 min,  1 user,  load average: 0.00, 0.03, 0.30
#     現在時間 サーバーの  ログイン                 1分   5分   15分
#             稼働時間   ユーザー数               間の単位時間あたりの待ちタスク数
```

参考：[topコマンドの使い方 \- Qiita](https://qiita.com/k0kubun/items/7368c323d90f24a00c2f)


## netdata

https://my-netdata.io/

netdata はサーバメトリクスのモニタリングツール。チャートで一覧できる。インストールが簡単。自動で各種アプリケーションを検知してメトリクスを追加してくれる。

`top`, `vmstat`, `iostat`, `iotop`, `sar` などのコマンドを1つずつ叩かなくて良くなる。

### install

```
bash <(curl -Ss https://my-netdata.io/kickstart-static64.sh)
```

### ダッシュボード

19999 番ポートでWebダッシュボードにアクセスできる。
